function DataStack(t){t=t||{},this.stack={},this.debug=t.debug||!1}DataStack.prototype.get=function(t,e){return this.stack[t]?this.stack[t][e]:(this.error("Unexpected module: "+t),!1)},DataStack.prototype.set=function(t,e,i){return this.stack[t]||(this.stack[t]={},this.debug&&this.log("Resolved data space for module: "+t)),this.stack[t][e]=i,i},DataStack.prototype.error=function(t){console.error("DataStack error:\n",t)},DataStack.prototype.log=function(t){console.log("DataStack log message:\n",t)};var excessor=excessor||new DataStack;excessor.set("pirate","compileNextState",function(t){var e=1e3/this.fps,i=(t.endShift-t.startShift)/(t.time/e);if(t._shift>=t.endShift&&(t._shift=t.endShift),t.frame(t.start+(t.end-t.start)*t.shift),t._shift>=t.endShift&&!t.reverse||t._shift<=t.startShift&&t.reverse)return t.recourse?void t.repeat():(this.remove(t.id),void t.callback(t.callbackAttribute));t.reverse?t._shift-=i*t.rate:t._shift+=i*t.rate}),function(){function t(t){this.stack={},this.fps=0,this._fps=t}t.prototype.play=function(t){this.fps=+t||this.fps},t.prototype.pause=function(){var t=this.fps;this.fps=0,this._fps=t},t.prototype.compileNextState=excessor.get("pirate","compileNextState"),t.prototype.render=function(){var t=this.stack;for(var e in t)this.compileNextState(t[e])},t.prototype.append=function(t){0===Object.keys(this.stack).length&&this.play(),this.stack[t.id]=t},t.prototype.remove=function(t){delete this.stack[t],0===Object.keys(this.stack).length&&this.pause()},Object.defineProperty(t.prototype,"fps",{get:function(){return this._fps},set:function(t){var e=this;this.core&&clearInterval(this.core),t&&(this.core=setInterval(function(){e.render()},1e3/+t)),this._fps=t}}),excessor.set("pirate","core",t)}(),function(){function t(t){return 7===t.length&&0===t.search(/#[0-9a-f]{6}/i)||4===t.length&&0===t.search(/#[0-9a-f]{3}/i)}function e(t){return 0===t.search(/rgb\(( ?\d{1,3},){2} ?\d{1,3}\)/i)}function i(t){return 0===t.search(/rgba\(( ?\d{1,3},){3}( ?\d(\.\d+)?)\)/i)}var n={getPointOnCircle:function(t,e,i,n){i=+i||0,n=+n||0;var r=+e*Math.sin(+t);return[i+ +e*Math.cos(+t),n+r]},getPointOnEllipse:function(t,e,i,n,r,s){n=n||0,n*=-1,r=r||0,s=s||0;var o=t*Math.cos(+i),a=e*Math.sin(+i);return[o*Math.cos(n)+a*Math.sin(n)+r,-o*Math.sin(n)+a*Math.cos(n)+s]},getPointsFromPolygon:function(t,e,i,n,r){var s=[];s.push(this.getPointOnCircle(e,i,n,r));for(var o=0;o<t;o++)s.push(this.getPointOnCircle(2*Math.PI/t*o+e,i,n,r));return s},getPointOnCurve:function(t,e){for(var i=[0,0],n=e.length-1,r=0;e[r];r++){var s=this.factorial(n)/(this.factorial(r)*this.factorial(n-r))*Math.pow(t,r)*Math.pow(1-t,n-r);i[0]+=e[r][0]*s,i[1]+=e[r][1]*s}return i},getPointOnLine:function(t,e){return[(e[1][0]-e[0][0])*t+e[0][0],(e[1][1]-e[0][1])*t+e[0][1]]},getCenterToPointDistance:function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},HEXtoRGBA:function(t){var e=[];return 4===t.length&&(e[0]=parseInt(t.substring(1,2)+t.substring(1,2),16),e[1]=parseInt(t.substring(2,3)+t.substring(2,3),16),e[2]=parseInt(t.substring(3)+t.substring(3),16)),7===t.length&&(e[0]=parseInt(t.substring(1,3),16),e[1]=parseInt(t.substring(3,5),16),e[2]=parseInt(t.substring(5),16)),e[3]=1,e},RGBtoRGBA:function(t){var e=t.match(/\d{1,3}(\.\d+)?/g);return"0"===e[3]?e[3]=0:e[3]=+e[3]||1,e},changeColor:function(r,s,o){var a=[];i(r)||e(r)?r=n.RGBtoRGBA(r):t(r)&&(r=n.HEXtoRGBA(r)),i(s)||e(s)?s=n.RGBtoRGBA(s):t(s)&&(s=n.HEXtoRGBA(s));for(var h=0;h<3;h++)a[h]=Math.round(+r[h]+(+s[h]-+r[h])*o);var c=+(+r[3]+(+s[3]-+r[3])*o).toFixed(4);return"rgba("+a[0]+","+a[1]+","+a[2]+","+c+")"},factorial:function(t){for(var e=1;t;)e*=t--;return e},getAngleOfVector:function(t,e){e=e||[0,0],t=[(t=t||[0,0])[0]-e[0],t[1]-e[1]];var i=n.getCenterToPointDistance(t),r=Math.asin(t[1]/i);return Math.acos(t[0]/i)>Math.PI/2?Math.PI-r:r},getLengthOfCurve:function(t,e){e=e||1;for(var i=0,r=t[0],s=0;s<=100;s+=e){var o=n.getPointOnCurve(s,t);i+=n.getCenterToPointDistance([o[0]-r[0],o[1]-r[1]]),r=o}return i},getMapOfSpline:function(t,e){for(var i=[[]],r=0,s=0;t[s];s++){var o=i[r].length;i[r][+o]=t[s],t[s][2]&&s!=t.length-1&&(i[r]=n.getLengthOfCurve(i[r],e),i[++r]=[t[s]])}return i[r]=n.getLengthOfCurve(i[r],e),i},getPointOnSpline:function(t,e,i){var r=i.length*t;t>=1&&(r=i.length);for(var s=0,o=0,a=0,h=[];i.map[o]&&s+i.map[o]<r;o++)s+=i.map[o];for(var c=0;e[c]&&a<=o;c++)!0===e[c][2]&&a++,a>=o&&h.push(e[c]);return n.getPointOnCurve((r-s)/(i.map[o]/100),h)},getLengthOfEllipticArc:function(t,e,i,n,r){r=r||1;for(var s=0,o=this.getPointOnEllipse(t,e,i),a=(n-i)/100,h=0;h<=100;h+=r){var c=i+a*h,f=this.getPointOnEllipse(t,e,c);s+=this.getCenterToPointDistance([f[0]-o[0],f[1]-o[1]]),o=f}return s},getMapOfPath:function(t,e){for(var i=[[]],r=0,s=[],o=0;t[o];o++){var a=t[o];if(a.length>3){if(i[r]=this.getLengthOfEllipticArc(a[0],a[1],a[2],a[3],e),!t[o+1])continue;var h=this.getPointOnEllipse(a[0],a[1],a[2]+Math.PI,a[4],s[0],s[1]),c=this.getPointOnEllipse(a[0],a[1],a[3],a[4],h[0],h[1]);i[++r]=[c],s=c}else i[r].push(a),(!0===a[2]||t[o+1]&&t[o+1].length>3)&&(i[r]=n.getLengthOfCurve(i[r],e),i[++r]=[a]),s=a}return"number"!=typeof i[r]&&(i[r]=n.getLengthOfCurve(i[r],e)),i},getPointOnPath:function(t,e,i){var n=i.length*t;t>=1&&(n=i.length);for(var r=0,s=0,o=0,a=[];i.map[s]&&r+i.map[s]<n;s++)r+=i.map[s];for(var h=[],c=0;e[c]&&o<=s;c++){var f=e[c];if(f.length>3){var u=this.getPointOnEllipse(f[0],f[1],f[2]+Math.PI,f[4],h[0],h[1]);if(o===s){var p=(n-r)/(i.map[s]/100),g=f[2]+(f[3]-f[2])/100*p;return this.getPointOnEllipse(f[0],f[1],g,f[4],u[0],u[1])}h=this.getPointOnEllipse(f[0],f[1],f[3],f[4],u[0],u[1]),++o===s&&a.push(h)}else(!0===f[2]||e[c+1]&&e[c+1].length>3)&&o++,o>=s&&a.push(f),h=f}return this.getPointOnCurve((n-r)/(i.map[s]/100),a)}};excessor.set("pirate","formula",n)}(),function(){var t=excessor.get("pirate","formula");function e(t){t=t||{},this.id=t.id||""+Math.random(),this.frame=t.frame||function(){},this.callback=t.callback||function(){},this.callbackAttribute=t.callbackAttribute,this.endShift=t.endShift||1,this.startShift=t.startShift||0,this._shift=t.shift||this.startShift,this.start=t.start||0,this.end=t.end||1,this.time=+t.time,this.rate=t.rate||1,this.factor=t.factor||1,this.recourse=!!t.recourse,this.reverse=!!t.reverse,this.timingFunction=t.timingFunction,0===t.end&&(this.end=0),this.defaultTimingFunctions={ease:[[.25,.1],[.25,1]],"ease-in":[[.42,0],[1,1]],"ease-out":[[0,0],[.58,1]],"ease-in-out":[[.42,0],[.58,1]]}}Object.defineProperties(e.prototype,{shift:{get:function(){return this._timingFunction?t.getPointOnCurve(this._shift,this.timingFunction)[1]:+this._shift},set:function(t){return this.shift}},timingFunction:{get:function(){var t=[[0,0]];return(t="string"==typeof this._timingFunction?t.concat(this.defaultTimingFunctions[this._timingFunction]):t.concat(this._timingFunction)).push([1,1]),t},set:function(t){this._timingFunction=t}}}),e.prototype.play=function(t){return this.rate=t||1,this},e.prototype.pause=function(){return this.rate=0,this},e.prototype.stop=function(){return this.rate=0,this.reverse?this._shift=this.endShift:this._shift=this.startShift,this},e.prototype.repeat=function(){this.reverse?this._shift=this.endShift:this._shift=this.startShift},excessor.set("pirate","operation",e)}();